!function(e){function t(e,t){for(var n,r=-1,i=[];(n=t.exec(e))&&r!==n.index;)i.push(n),r=n.index;return i}function n(){this.get=function(n){var r=n.serializeArrayJSON(),i={},a={},s={key:/[^\[\]\.]+|\[\]/g,push:/^\[\]$/,fixed:/^\d+$/,named:/^[^\[\]\.]+$/},u=function(e,t,n){return e[t]=n,e},o=function(e){return void 0===a[e]&&(a[e]=0),a[e]++};return e.each(r,function(){for(var e,n,r=t(this.name,s.key),a=this.value;e=r.pop();)n=e[0],n.match(s.push)?a=u([],o(this.name.substr(0,e.index)),a):n.match(s.fixed)?a=u([],n,a):n.match(s.named)&&(a=u({},n,a));jQuery.extend(!0,i,a)}),i},this.set=function(t,n){var r,i=[],a=t.find("input,textarea,select"),s={},u=function(t,n,r,a){e.each(n,function(n,o){var c=n;r?c="."+n:a&&(c="["+n+"]");var f=t+c;return e.isPlainObject(o)?void u(f,o,!0):e.isArray(o)?s[f+"[]"]?void i.push({name:f+"[]",value:o}):void u(f,o,!1,!0):void i.push({name:f,value:o})})},o={};e.each(a,function(){if(e(this).attr("name")){var t=e.map(e(this).attr("name").split("[]"),function(e){return e.replace(/\[(.+?)\]/gi,".$1").replace(/\.(\d+)([\[\.])/,"[$1]$2").replace(/\.(\d+)$/,"[$1]")}),n=t.join("[]"),r=t.slice(0,-1);if("[]"==n.substr(-2)&&e(this).is("select,[type=checkbox]")&&(r=r.slice(0,-1)),r.length>0){n="";var i="";e.each(r,function(){i+=this+"[]","undefined"==typeof o[i]?o[i]=0:o[i]++,n+=this+"["+o[i]+"]"})}s[n]||(s[n]=[]),s[n].push(this)}}),u("",n),e.each(i,function(){var t=this.name,n=this.value;if(r=e(s[t])){switch(r.attr("type")){case"checkbox":case"radio":return e.isArray(n)?void r.valJSON(n).change():n===!1||null===n?void r.prop("checked",!1).change():(r=r.filter(function(t,r){return e(r).val()==n}),void r.prop("checked",!0).change())}var i=r.valJSON(n);i&&i.change&&i.change()}})},this.setDefaults=function(e,t){},this.reset=function(e,t){var n=e.get(0);n.reset&&n.reset(),"undefined"!=typeof t&&this.setDefaults(e,t)}}e.formJSON={getterSetters:{"int":{get:function(t){return parseInt(e(t).val())},set:function(t,n){return e(t).val(""+n)}},"float":{get:function(t){return parseFloat(e(t).val())},set:function(t,n){return e(t).val(""+n)}},"boolean":{get:function(t){return"true"===e(t).val()||"1"===e(t).val()},set:function(t,n){return e(t).val(n?"true":"false")}}}},e.fn.valJSON=function(t){var n=e(this).data("json-type");return"string"==typeof n&&(n=e.formJSON.getterSetters[n]),n&&n.get&&n.set?"undefined"==typeof t?n.get(this):n.set(this,t):"undefined"==typeof t?e(this).val():e(this).val(t)};var r=/^(?:submit|button|image|reset)$/i,i=/^(?:radio|checkbox)$/i,a=/^radio$/i,s=/\[\]$/,u=/^(?:input|select|textarea|keygen)/i;e.fn.serializeArrayJSON=function(){var t={},n=[];return this.map(function(){var t=e.prop(this,"elements");if(t)return e.makeArray(t);var n=e(this);return n.is(":input")?this:e.makeArray(n.find(":input"))}).filter(function(){return this.name&&!e(this).is(":disabled")&&u.test(this.nodeName)&&!r.test(this.type)}).each(function(n,r){var u=r.name,o=r.type,c=e(r).valJSON();if(t[u]||!s.test(u)&&!e.isArray(c)||(t[u]=[]),s.test(u)&&null!=c&&!e.isArray(c)&&(c=[c]),i.test(o)){if(!e.isArray(c)){if(a.test(o)&&t[u])return;return void(t[u]=this.checked?c:a.test(o)?null:!1)}if(e.isArray(c)&&!this.checked)return}return e.isArray(c)?void e.merge(t[u],c):void(null!=c&&(t[u]=c))}),e.each(t,function(t,r){return e.isArray(r)?(r.length||n.push({name:t,value:void 0}),void e.each(r,function(e,r){n.push({name:t,value:r})})):void n.push({name:t,value:r})}),n},e.fn.formJSON=function(e,t){var r,i=this;return(r=this.data("formJSON"))||this.data("formJSON",r=new n),"get"===e?r.get(i):("set"===e?r.set(i,t):"setDefaults"===e?r.setDefaults(i,t):"reset"===e?r.reset(i,t):"destroy"===e&&el.removeData("formJSON"),i)}}(jQuery);